# -------------------------------------------------
# FamFlix Media Stack â€” Local (HTTP) + Public (HTTPS)
# -------------------------------------------------
# .local routes -> HTTP only (no TLS)
# .famflix.live routes -> HTTPS via Let's Encrypt
# -------------------------------------------------
{
	email hadenhiles@gmail.com
	acme_ca https://acme-v02.api.letsencrypt.org/directory
	auto_https disable_redirects
}

# ---------- LOCAL ROUTES (HTTP ONLY) ----------
# (Accessible within LAN only)

# Plex
http://plex.local {
	@root path /
	redir @root /web
	reverse_proxy {
		to plex:32400
		flush_interval -1
	}
}

# qBittorrent
http://qbittorrent.local {
	reverse_proxy {
		to qbit-proxy:8082
	}
}

# SABnzbd
http://sabnzbd.local {
	reverse_proxy {
		to sab-proxy:8080
	}
}

# Prowlarr
http://prowlarr.local {
	reverse_proxy {
		to prowlarr:9696
	}
}

# Sonarr
http://sonarr.local {
	reverse_proxy {
		to sonarr:8989
	}
}

# Radarr
http://radarr.local {
	reverse_proxy {
		to radarr:7878
	}
}

# Jellyseerr
http://jellyseerr.local {
	reverse_proxy {
		to jellyseerr:5055
	}
}

# Unmanic
http://unmanic.local {
	reverse_proxy {
		to unmanic:8888
	}
}

# Bazarr
http://bazarr.local {
	reverse_proxy {
		to bazarr:6767
	}
}

# Tautulli
http://tautulli.local {
	reverse_proxy {
		to tautulli:8181
	}
}

# Maintainerr
http://maintainerr.local {
	reverse_proxy {
		to maintainerr:6246
	}
}

# ---------- PUBLIC ROUTES (HTTPS ENABLED) ----------

# Plex (public)
plex.famflix.live {
	encode zstd gzip
	@root path /
	redir @root /web

	reverse_proxy {
		to http://plex:32400
		header_up Host plex.famflix.live
		header_up X-Real-IP { http.request.remote }
		header_up X-Forwarded-Proto https
		header_up X-Forwarded-Host plex.famflix.live
		flush_interval -1
	}
}

# Jellyseerr (public)
jellyseerr.famflix.live {
	tls {
		ca https://acme-v02.api.letsencrypt.org/directory
	}
	reverse_proxy {
		to jellyseerr:5055
	}
	encode zstd gzip
}

# Root domain redirect
famflix.live {
	redir https://plex.famflix.live
}
